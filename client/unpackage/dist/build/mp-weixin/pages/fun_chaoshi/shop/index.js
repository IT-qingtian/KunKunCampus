(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/fun_chaoshi/shop/index"],{"0885":function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return n}));var n={uSkeleton:function(){return Promise.all([r.e("common/vendor"),r.e("node-modules/uview-ui/components/u-skeleton/u-skeleton")]).then(r.bind(null,"c104"))},uTag:function(){return Promise.all([r.e("common/vendor"),r.e("node-modules/uview-ui/components/u-tag/u-tag")]).then(r.bind(null,"9f63"))},uNumberBox:function(){return Promise.all([r.e("common/vendor"),r.e("node-modules/uview-ui/components/u-number-box/u-number-box")]).then(r.bind(null,"8f50"))},uIcon:function(){return Promise.all([r.e("common/vendor"),r.e("node-modules/uview-ui/components/u-icon/u-icon")]).then(r.bind(null,"2513"))},uAvatar:function(){return Promise.all([r.e("common/vendor"),r.e("node-modules/uview-ui/components/u-avatar/u-avatar")]).then(r.bind(null,"797d"))}},o=function(){var e=this,t=e.$createElement,r=(e._self._c,e.shopData.img_address.length),n=r?e.shopData.img_address[0].replaceAll("\\","/"):null,o=e.shopData.goods.length,a=e.shopData.goods.length,s=e.place_order_price&&e.place_order_price<e.shopData.start_run_price?Math.round(100*(e.shopData.start_run_price-e.place_order_price)):null,i=e.shopData.comment.length,c=i>0?e.__map(e.shopData.comment,(function(t,r){var n=e.__get_orig(t),o=t.img?t.img.replaceAll("\\","/"):null;return{$orig:n,g6:o}})):null,u=e.__map(e.shopData.img_address.slice(1),(function(t,r){var n=e.__get_orig(t),o=t.replaceAll("\\","/");return{$orig:n,g7:o}}));e._isMounted||(e.e0=function(t,r){var n=arguments[arguments.length-1].currentTarget.dataset,o=n.eventParams||n["event-params"];r=o.item;e.showImg(e.serverAddress+r.replaceAll("\\","/"))}),e.$mp.data=Object.assign({},{$root:{g0:r,g1:n,g2:o,g3:a,g4:s,g5:i,l0:c,l1:u}})},a=[]},"258d":function(e,t,r){"use strict";(function(e){var n=r("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(r("2eee")),a=n(r("9523")),s=n(r("c973")),i=r("26cb"),c=r("b6a4");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l={name:"index",data:function(){return{place_order_ing:!1,imgShow:{is:!1,address:""},placeOrder:{goods:{goods_li_arr:[],goods_li_arr_end_height:"0",anchor_id:"",scroll_top:"0",scroll_view_height:"0"}},paging_current:0,shops_index:0,shopData:{goods:[],img_address:[],comment:[]},loading:!0,serverAddress:c.serverAddress}},onLoad:function(t){var r=this;return(0,s.default)(o.default.mark((function n(){var a;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=t.id,void 0!==a){n.next=3;break}return n.abrupt("return",e.navigateBack());case 3:r.getShopInfo(a);case 4:case"end":return n.stop()}}),n)})))()},computed:d(d({},(0,i.mapState)("store_user",["token"])),{},{place_order_price:function(){var e=this.shopData.goods.reduce((function(e,t){return t.goods.map((function(t){e+=t.price*t.number})),Number(e.toFixed(2))}),0);return e}}),methods:d(d({},(0,i.mapMutations)("store_user",["update_temp_data"])),{},{showImg:function(e){this.imgShow.address=e,this.imgShow.is=!0},closeImgShow:function(){this.imgShow.is=!1},view_init:function(){var t=this,r=e.createSelectorQuery();r.select(".shop_goods").boundingClientRect((function(e){t.placeOrder.goods.scroll_view_height=e.height+"px"})).exec();var n=e.createSelectorQuery();n.selectAll(".goods_li_").boundingClientRect((function(e){if(!e.length)return console.log("错误啦");t.placeOrder.goods.goods_li_arr=e;var r=e.length-1;t.placeOrder.goods.goods_li_arr_end_height=parseInt(t.placeOrder.goods.goods_li_arr[r].height)<=parseInt(t.placeOrder.goods.scroll_view_height)?t.placeOrder.goods.scroll_view_height:t.placeOrder.goods.goods_li_arr[r].height+50+"px"})).exec()},getShopInfo:function(t){var r=this;return(0,s.default)(o.default.mark((function n(){var a,s,i,c,u;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$httpRequest({url:"shop/getShop",method:"post",header:{authorization:"bearer ".concat(r.token)},data:{id:t}});case 2:if(a=n.sent,s=a.data,i=s.code,c=s.data,u=s.msg,i){n.next=9;break}return n.abrupt("return",e.$showMsg(u));case 9:console.log(c.result,"店铺数据"),c.result.goods=c.result.goods.filter((function(e){if(e.goods.length)return e.goods.forEach((function(e){e.number=0})),e})),r.shopData=c.result,r.shopData.comment.reverse(),r.loading=!1,console.log(r.shopData,"格式化以后的店铺数据"),r.is_business(),r.$nextTick((function(){r.view_init()}));case 17:case"end":return n.stop()}}),n)})))()},is_business:function(){var t=new Date,r=this.shopData,n=r.start_time,o=r.end_time,a="".concat(String(t.getHours()).padStart(2,"0"),":").concat(String(t.getMinutes()).padStart(2,"0"));return a>=n&&a<=o||(e.showToast({title:"店家已打样~",icon:"error"}),!1)},click_place_order:function(){var t=this;return(0,s.default)(o.default.mark((function r(){var n,a,s,i,c,u,d,l,p;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.is_business()){r.next=2;break}return r.abrupt("return");case 2:if(!t.place_order_ing){r.next=4;break}return r.abrupt("return",console.log("正在下单中"));case 4:if(t.place_order_ing=!0,console.log("点击下单，正在列出信息",t.shopData.goods),n=t.shopData.goods,a=n.reduce((function(e,t){return t.goods.map((function(t){if(t.number>0){var r=t.id,n=t.name,o=t.price,a=t.number,s={id:r,name:n,price:o,number:a};e.push(s)}})),e}),[]),console.log("整理好后的数据",a),a.length){r.next=11;break}return r.abrupt("return",e.$showMsg("您还没有选择想要的东西呢"));case 11:return r.next=13,e.$httpRequest({url:"shop/createOrder",method:"post",header:{authorization:"bearer ".concat(t.token)},data:{shop_id:t.shopData.id,goods:a}});case 13:if(s=r.sent,i=s.data,c=i.code,u=i.data,d=i.msg,console.log(u,d,c),t.place_order_ing=!1,c){r.next=22;break}return r.abrupt("return",e.$showMsg(d));case 22:l=u.payInfo,p=u.subscribeMessageArray,e.requestSubscribeMessage({tmplIds:p,complete:function(t){e.navigateTo({url:"/pages/fun_chaoshi/comfirm/index?out_trade_no=".concat(l.out_trade_no)})}});case 24:case"end":return r.stop()}}),r)})))()},change_paging:function(e){this.paging_current=e},change_paging_swiper:function(e){this.paging_current=e.detail.current},shops_select_click:function(e){this.shops_index=e,this.placeOrder.goods.scroll_with_animation=!0,this.placeOrder.goods.anchor_id="goods_anchor_id_"+e},scroll_goods_:function(e){var t=this,r=e.detail.scrollTop;clearTimeout(this.scroll_goods_timer),this.scroll_goods_timer=setTimeout((function(){for(var e=t.placeOrder.goods.goods_li_arr,n=0,o=0;o<e.length;o++){if(n+=e[o].height,parseInt(r)<parseInt(n)){t.shops_index=o;break}if(parseInt(r)===parseInt(n)){t.shops_index=o+1;break}}}),100)}})};t.default=l}).call(this,r("543d")["default"])},"3b73":function(e,t,r){"use strict";r.r(t);var n=r("258d"),o=r.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(a);t["default"]=o.a},"54ce":function(e,t,r){},d68a:function(e,t,r){"use strict";var n=r("54ce"),o=r.n(n);o.a},d9b6:function(e,t,r){"use strict";r.r(t);var n=r("0885"),o=r("3b73");for(var a in o)["default"].indexOf(a)<0&&function(e){r.d(t,e,(function(){return o[e]}))}(a);r("d68a");var s=r("f0c5"),i=Object(s["a"])(o["default"],n["b"],n["c"],!1,null,"281d5a3e",null,!1,n["a"],void 0);t["default"]=i.exports},e39f:function(e,t,r){"use strict";(function(e,t){var n=r("4ea4");r("b320");n(r("66fd"));var o=n(r("d9b6"));e.__webpack_require_UNI_MP_PLUGIN__=r,t(o.default)}).call(this,r("bc2e")["default"],r("543d")["createPage"])}},[["e39f","common/runtime","common/vendor"]]]);